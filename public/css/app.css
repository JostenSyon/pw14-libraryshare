:root {
  --sidebar-w: 280px;
  --topbar-h: 56px;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: #f6f7f9;
  padding-top: var(--topbar-h);
}

/* Barra superiore */
.topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--topbar-h);
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 14px;
  background: #ac2626;
  color: #fff;
  z-index: 1100;
}

.brand { font-weight: 700; }
.spacer { flex: 1; }

.btn {
  border: 1px solid rgba(255,255,255,.2);
  background: transparent;
  color: #fff;
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
}

.icon {
  border: 0;
  background: transparent;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
}

.hidden { display: none !important; }

/* MAIN */
.app { padding: 16px; }

/* Barra laterale - Su mobile parte come overlay */
.drawer {
  position: fixed;
  top: var(--topbar-h);
  left: 0;
  width: var(--sidebar-w);
  height: calc(100dvh - var(--topbar-h));
  background: #fff;
  border-right: 1px solid #e6e6e6;
  padding: 14px;
  box-shadow: 0 8px 30px rgba(0,0,0,.12);
  z-index: 30;
  overflow-y: auto;
}

/* In desktop tengo la sidebar sempre visibile:
   così evito stati doppi (aperta/chiusa) e gestione extra delle animazioni. */

@media (min-width: 900px) {
  #btnMenu { display: none; }

  .drawer {
    box-shadow: none;
  }

  .drawer.hidden { display: block !important; }

  #app { margin-left: var(--sidebar-w); }
}

/* Menu laterale minimale */
.nav { display: flex; flex-direction: column; gap: 6px; }
.nav__item {
  display: block;
  padding: 10px 10px;
  border-radius: 10px;
  color: #ac2626;
  text-decoration: none;
}
.nav__item:hover { background: #f1f1f1; }
.nav__sep { height: 1px; background: #e7e7e7; margin: 8px 0; }




/* --- Modale per il login --- */
.modal {
  position: fixed;
  inset: 0;
  z-index: 1200;
}

.modal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.5);
}

.modal__panel {
  position: relative;
  width: min(420px, calc(100% - 24px));
  margin: 10vh auto 0;
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 12px 40px rgba(0,0,0,.25);
}

/* Dettaglio libro: pannello più largo e scrollabile per l'edit admin */
#bookModal .modal__panel {
  max-height: calc(100vh - 24px);
  margin-top: 12px;
  overflow: auto;
}

#bookModalActions {
  flex-wrap: wrap;
}

.modal__title {
  margin: 0 0 12px;
  font-size: 18px;
  color: #111;
}

.form {
  display: grid;
  gap: 10px;
}

.form__label {
  display: grid;
  gap: 6px;
  font-size: 14px;
  color: #111;
}

.form__input {
  padding: 10px 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  outline: none;
}

.form__input:focus {
  border-color: #999;
}

.form__actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 6px;
}

/* stile per i pulsanti primari delle modali */
.btn--primary {
  background: #111;
  border-color: #111;
  color: #fff;
}

.btn--ghost {
  background: transparent;
  border-color: #ddd;
  color: #111;
}

.form__error {
  padding: 10px;
  border-radius: 10px;
  background: #fff3f3;
  border: 1px solid #ffd1d1;
  color: #8a1f1f;
  font-size: 13px;
}


/* --- liste e cards --- */
.list { display: grid; gap: 10px; max-width: 820px; }

.card {
  background: #fff;
  border: 1px solid #e7e7e7;
  border-radius: 14px;
  padding: 12px;
}

.card__row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.card__title {
  font-weight: 700;
  color: #111;
}

.card__meta {
  margin-top: 6px;
  font-size: 13px;
  color: #555;
}

.badge {
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid #ddd;
  white-space: nowrap;
}

.badge--ok {
  background: #f2fff5;
  border-color: #bfeccc;
  color: #146c2e;
}

.badge--no {
  background: #fff6f6;
  border-color: #ffd1d1;
  color: #8a1f1f;
}

.error {
  margin-top: 10px;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ffd1d1;
  background: #fff3f3;
  color: #8a1f1f;
}

.suggest {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% + 6px);
  background: #fff;
  border: 1px solid #e7e7e7;
  border-radius: 12px;
  padding: 6px;
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
  z-index: 60;
}

.suggest__item {
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border: 0;
  background: transparent;
  border-radius: 10px;
  cursor: pointer;
}

.suggest__item:hover { background: #f1f1f1; }

/* Utility essenziali usate nelle view */
.muted { color: #666; }
.mb-12 { margin-bottom: 12px; } .mt-6 { margin-top: 6px; } .mt-10 { margin-top: 10px; } .mt-12 { margin-top: 12px; }
.section-block { margin: 18px 0; }
.section-title { margin: 0 0 10px; font-size: 18px; }
.scroll-row {
  display: flex;
  gap: 12px;
  overflow: auto;
  padding: 6px 2px;
  position: relative;
  --fade-size: 45px;
  -webkit-mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 var(--fade-size),
    #000 calc(100% - var(--fade-size)),
    transparent 100%
  );
  mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 var(--fade-size),
    #000 calc(100% - var(--fade-size)),
    transparent 100%
  );
}

.scroll-row.is-start {
  -webkit-mask-image: linear-gradient(
    to right,
    #000 0,
    #000 calc(100% - var(--fade-size)),
    transparent 100%
  );
  mask-image: linear-gradient(
    to right,
    #000 0,
    #000 calc(100% - var(--fade-size)),
    transparent 100%
  );
}

.scroll-row.is-end {
  -webkit-mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 var(--fade-size),
    #000 100%
  );
  mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 var(--fade-size),
    #000 100%
  );
}

.scroll-row.is-start.is-end {
  -webkit-mask-image: none;
  mask-image: none;
}

.scroll-controls {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin-top: 6px;
}

.scroll-btn {
  border: 1px solid #ddd;
  background: #fff;
  color: #555;
  border-radius: 999px;
  width: 28px;
  height: 28px;
  cursor: pointer;
  font-size: 12px;
  line-height: 1;
}

.scroll-btn:disabled {
  opacity: 0.45;
  cursor: default;
}
.stack-col-10 { display: flex; flex-direction: column; gap: 10px; }
.max-w-520 { max-width: 520px; }
.max-w-820 { max-width: 820px; }
.max-w-980 { max-width: 980px; }
.between { justify-content: space-between; }
.start { justify-content: flex-start; }
.center { align-items: center; }
.label-relative { position: relative; }
.u-row-wrap { display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; }
.u-row-center { display: flex; align-items: center; gap: 8px; }
.u-m-0 { margin: 0; }
.search-results-grid,
.mybooks-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 14px;
}
.mybooks-view-btn { display: flex; align-items: center; justify-content: center; border: 1px solid #bbb; background: transparent; color: #111; opacity: 0.85; }
.mybooks-view-btn.is-active { border-color: #ac2626; background: #ac2626; color: #fff; opacity: 1; }
.lookup-inline { display: flex; gap: 8px; align-items: flex-end; }
.lookup-inline .form__label { flex: 1; }
.lookup-inline .btn { height: 42px; white-space: nowrap; }
#coverPreviewImg { max-width: 180px; border-radius: 8px; border: 1px solid #ddd; }

#btnSetLocationMini { padding: 6px 10px; line-height: 1; }
#searchStatus { margin: 10px 0; }
#searchForm .search-col-main { flex: 1 1 240px; }
#searchForm .search-col-sm { width: 160px; }
#searchForm .search-col-md { width: 210px; }
#searchForm .form__actions { margin: 0; }

#admin-stats-lists, #admin-tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
#admin-stats-lists { margin-top: 16px; }
#admin-map { height: 360px; border: 1px solid #eee; border-radius: 10px; overflow: hidden; }
#admin-user-search-row { display: grid; grid-template-columns: 1fr 180px; gap: 8px; }
#admin-user-edit-username { padding: 0; border: 0; background: transparent; color: #666; font-size: 12px; text-decoration: underline; cursor: pointer; }

/* Testo nascosto visivamente ma leggibile dagli screen reader */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Pulsanti vista lista/griglia in "I miei libri": icona sempre leggibile */
#viewListBtn svg,
#viewGridBtn svg {
  fill: currentColor;
}

/* Tile libro condivisa tra le view */
.book-tile {
  background: #fff;
  border: 1px solid #e7e7e7;
  border-radius: 14px;
  padding: 10px;
}

.book-tile__main { display: flex; align-items: flex-start; gap: 10px; }
.book-tile__media { flex: 0 0 auto; }

.book-tile__cover {
  width: 72px;
  height: 108px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.book-tile__cover-placeholder {
  width: 72px;
  height: 108px;
  border-radius: 8px;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #777;
  font-size: 12px;
  text-align: center;
  padding: 6px;
  background: #fafafa;
}

.book-tile__body { flex: 1; min-width: 0; }

.book-tile__head { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
.book-tile__chips { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }

.book-tile__meta {
  margin-top: 4px;
  font-size: 13px;
  color: #555;
}

.book-tile__actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px; flex-wrap: wrap; }
.book-tile__side { margin-left: auto; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }

.book-tile__side .btn {
  white-space: nowrap;
}

.book-tile--loan .book-tile__cover {
  width: 48px;
  height: 72px;
  border: 1px solid #e7e7e7;
}

.book-tile--loan .book-tile__cover-placeholder {
  width: 48px;
  height: 72px;
}

.book-tile--loan .book-tile__actions {
  margin-top: 8px;
}

.book-tile--compact .book-tile__main {
  flex-direction: column;
  flex: 1;
  position: relative;
}

.book-tile--compact .book-tile__media {
  width: 100%;
  display: flex;
  justify-content: center;
}

.book-tile--compact {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.book-tile--compact .book-tile__body {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.book-tile--compact .card__title {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
  min-height: 2.6em;
  line-height: 1.3;
}

.book-tile--compact .book-tile__cover,
.book-tile--compact .book-tile__cover-placeholder {
  width: 100%;
  height: 220px;
  border-radius: 12px;
}

.book-tile--compact .book-tile__actions {
  justify-content: stretch;
  margin-top: auto;
  padding-top: 10px;
}

.book-tile--compact .book-tile__actions .btn {
  width: 100%;
}

.book-tile--compact .book-tile__head {
  margin-top: 4px;
}

.book-tile--compact .book-tile__chips {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 1;
}

.book-tile--compact .book-tile__chips .badge {
  padding: 4px 8px;
  font-size: 11px;
}

.book-tile--my-list .book-tile__actions,
.book-tile--newbook-local .book-tile__actions,
.book-tile--newbook-ol .book-tile__actions {
  justify-content: flex-start;
}

.scroll-row .book-tile--compact {
  min-width: 180px;
  max-width: 180px;
}

@media (max-width: 760px) {
  .lookup-inline {
    flex-wrap: wrap;
  }

  .lookup-inline .btn {
    width: 100%;
  }

  .scroll-row .book-tile--compact {
    min-width: 160px;
    max-width: 160px;
  }
}
